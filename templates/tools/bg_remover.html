<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>إزالة خلفية الصورة (rembg)</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#1b4965] via-[#62b6cb] to-[#e9c46a] text-white">
	<div class="max-w-4xl mx-auto p-6">
		<div class="flex items-center justify-between">
			<h1 class="text-3xl font-extrabold">إزالة الخلفية من الصور</h1>
			<a href="/tools" class="rounded-lg bg-white/90 text-[#1b4965] px-4 py-2 font-semibold">العودة للأدوات</a>
		</div>

		<div class="mt-6 bg-white/10 border border-white/20 rounded-2xl p-6">
			<form id="form" class="space-y-4" onsubmit="return false;">
				<div>
					<label class="block mb-1">رفع صورة</label>
					<input id="image" type="file" accept="image/*" class="block w-full text-black rounded" />
					<p id="meta" class="text-white/80 text-sm mt-2 hidden"></p>
				</div>
				<button id="submit" class="rounded-xl bg-[#e9c46a] text-[#7a3b2e] font-bold px-6 py-3">إزالة الخلفية</button>
			</form>

			<div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
				<div>
					<h2 class="font-semibold mb-2">قبل</h2>
					<div id="preview" class="rounded overflow-hidden bg-white/90 min-h-[200px] flex items-center justify-center">
						<img id="inimg" class="max-w-full max-h-[400px]" alt="قبل" />
					</div>
				</div>
				<div>
					<h2 class="font-semibold mb-2">بعد</h2>
					<div id="afterwrap" class="rounded overflow-hidden bg-white/90 min-h-[200px] flex items-center justify-center">
						<img id="outimg" class="max-w-full max-h-[400px]" alt="بعد" />
					</div>
					<div id="result" class="mt-3 hidden">
						<a id="download" class="rounded-xl bg-white text-[#1b4965] font-semibold px-4 py-2" href="#">تنزيل PNG شفاف</a>
						<span id="used" class="ml-3 text-white/90"></span>
					</div>
				</div>
			</div>

			<div id="alert" class="mt-4 hidden rounded bg-red-500/20 border border-red-400/40 p-3"></div>
		</div>
	</div>

	<script>
		const image = document.getElementById('image');
		const inimg = document.getElementById('inimg');
		const outimg = document.getElementById('outimg');
		const result = document.getElementById('result');
		const download = document.getElementById('download');
		const alertBox = document.getElementById('alert');
		const meta = document.getElementById('meta');
		const used = document.getElementById('used');
		function showError(m){ alertBox.textContent=m; alertBox.classList.remove('hidden'); }
		function hideError(){ alertBox.classList.add('hidden'); alertBox.textContent=''; }

		image.addEventListener('change', () => {
			hideError(); result.classList.add('hidden'); outimg.removeAttribute('src');
			const f = image.files[0];
			if (!f) { inimg.removeAttribute('src'); meta.classList.add('hidden'); return; }
			const url = URL.createObjectURL(f);
			inimg.src = url;
			meta.textContent = `الاسم: ${f.name} — الحجم: ${(f.size/1024).toFixed(1)}KB — النوع: ${f.type||'غير معروف'}`;
			meta.classList.remove('hidden');
		});

		document.getElementById('submit').addEventListener('click', async () => {
			hideError(); result.classList.add('hidden');
			const fd = new FormData();
			if (image.files[0]) fd.append('image', image.files[0]);
			try {
				const res = await fetch('/api/background-remover', { method:'POST', body: fd });
				const data = await res.json();
				if(!res.ok || !data.success) throw new Error(data.error||'فشل المعالجة');
				outimg.src = data.url; download.href = data.url; used.textContent = `(rembg — model: ${data.model})`; result.classList.remove('hidden');
			} catch(e){ showError(e.message); }
		});
	</script>
</body>
</html>
